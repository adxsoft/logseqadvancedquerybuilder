<!DOCTYPE html>
<html>
    <h3 class="display-6 fw-bolder header1">Logseq Advanced Query Builder</h3>
    <small>v0.1 Alpha</small>
    <!-- <div>
        <H3>TODO</H3>
        <ul>
        </ul>
    </div>
 -->
    <p>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Standard pyscript includes for pyscript components-->
        <!-- <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script> -->
        
        <!-- Standard includes for latest pyscript components-->
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/> -->
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>      
        
        <!-- Local includes for pyscript components -->
        <!-- <script defer src="/static/pyscript/pyscript.js"></script> -->
        
        <!-- Add bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/css/bootstrap-night.min.css" rel="stylesheet">

        <!-- Custom style.css -->
        <!-- <link rel="stylesheet" href="style.css" type="text/css"> -->
        
        <title>Logseq Query Builder v0.01</title>
        <!-- <py-config>
            - autoclose_loader: true
            - runtimes:
                - src: "../static/pyodide/pyodide.js"
                  name: pyodide-0.20
                  lang: python
        </py-config> -->
        <!-- - pandas
        - xlrd -->
        <!-- - ./queryDict.py -->
        <!-- - ./logseq query building rules.xls -->
        <py-env> 
            - paths:
                - ./queryDB.py
                - ./logseqquerybuilder.py
        </py-env>
    </head>
    
    
    <body>
        <div style="width: 800px;">
            <i>An Experimental online tool to help Logseq Users build advanced queries from simple commands.</i><br><b>Only working in Firefox Browser at this stage</b><hr>
            <ul>
                <li>Enter commands in the yellow area below or choose an example.</li>
                <li>Tick <i>Include Query Comments</i> to show query line comments</li>
                <li>Tick  <i>Copy as code block</i> to wrap query in a Logseq code block</li>
                <li>Click the <b>Generate Advanced Query</b> button</li>
                to build the query.
                <ol>
                    <li>Optionally you can include comments for each query line.</i>
                </ol>
                <li>Copy the generated advanced query to the clipboard></li>
                <ol>
                    <li>(if necessary scroll down to see the result)</i>
                </ol>
                
                <li>Paste into Logseq using <i>Cmd(or Ctrl) Shift V</i></li><hr>
            </ul>
        </div>
        <h5 class="display1 fw-bolder header2">Command Input</h5>
        <button id="clear_commands_button" type="button" class="btn btn-primary active" role="button" aria-pressed="true">Clear</button>
        <select id="command_examples" class="btn btn-primary active" style="background-color:rgb(20, 50, 113);">
            <option value='' selected>Choose Example..</option>
            <option value='title: pages command - pages by wildcards&#10- pages&#10    - *'>pages - select all pages</option>
            <option value='title: pages command - specific pages&#10- pages&#10    - yourpagetitle1&#10    - yourpagetitle2'>pages - select specific pages</option>
            <option value='title: pages command - pages by wildcards&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*'>pages - using wildcards (*)</option>
            <option value='title: pages command - ignore pages (including wildcards)&#10- pages&#10    - not yourpagetitle1&#10    - not yourpagetitle2    - not mypage*&#10    - not starttext*&#10    - not *endtext&#10    - not *anytextanywhere*'>pages - ignore various pages</option>
            <option value='title: blocks command - ignore blocks using wildcards&#10- pages&#10    - not starttext*&#10    - not *endtext&#10    - not *anytextanywhere*'>blocks - by wildcards</option>
            <option value='title: blocktags - select and exclude block level tags&#10- blocktags&#10    - tag1&#10    - tag2&#10    - not tag3'>blocktags - select and exclude block level tags</option>
            <option value='title: blocktags and pages example&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1- blocktags&#10    - tag1&#10    - tag2&#10    - not tag3'>blocktags and pages</option>
            <option value='title: pagetags - page level tags&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1&#10- pagetags&#10    - pagetag1&#10    - pagetag2&#10    - not pagetag3'>pagetags - page level tags</option>
            <option value='title: pagetags and pages&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1&#10- pagetags&#10    - pagetag1&#10    - pagetag2&#10    - not pagetag3'>pagetags - with pages selection</option>
            <option value='title: select and exclude task types&#10- tasks&#10    - TODO&#10    - not DOING'>tasks - select and exclude task types</option>
            <option value='title: select and exclude task types&#10- pages&#10    - meeting*- tasks&#10    - TODO&#10    - not DOING'>tasks - tasks and pages</option>
            <option value='title: select and exclude pages with page properties&#10- pageproperties&#10    - pagetype, "meeting"&#10    - pagetype, "seminar"&#10    - not occurence, 1'>page properties - select pages using page property</option>
            <option value='title: select and exclude blocks with block properties&#10- blockproperties&#10    - grouptype, "meeting"&#10    - grouptype, "seminar"&#10    - not occurence, 1'>block properties - select blocks using block property</option>
            <option value='title: only search in specific namespace&#10- namespace&#10    - mynamespace'>namespace - only search in specific namespace</option>
            <option value='title: find block properties in a namespace&#10- namespace&#10    - fictionbooks&#10    - not nonfictionbooks&#10- blockproperties&#10    - bookgenre, "Western"&#10    - bookgenre, "History"'>namespace - find block properties in a namespace</option>
            <option value='title: find scheduled blocks in a namespace&#10- namespace&#10    - councilmeetings&#10    - not workmeetings&#10- scheduled'>scheduled - find scheduled blocks in a namespace</option>
            <option value='- schedulebetween&#10    - :today :30d-after'>scheduled - find scheduled blocks in a date range</option>
            <option value='title: find blocks with deadlines&#10- scheduled'>deadline - find blocks with deadlines</option>
            <option value='- deadlinebetween&#10    - :today :30d-after'>deadline - find deadline blocks in a date range</option>
        </select>
        <br>
        <p>
            <textarea id="commands_input" rows="10" cols="50" style="background-color:rgb(195, 192, 117); color:rgb(7, 7, 0);">
            </textarea>
        <hr>
        <h5 class="display1 fw-bolder header2">Generated Query</h5>
        <input id='command_comments_checkbox' type="checkbox" style="margin-right:10px;" value="unchecked">Include Query Comments
        <input id='codeblock_checkbox' type="checkbox" style="margin-right:10px; margin-left:10px;" value="unchecked">Copy as code block<p>
        <br>
        <button id="generate_query_button" type="button"  class="btn btn-primary active" role="button" aria-pressed="true">Generate Advanced Query</button>
        <button id="copy" hidden class="btn btn-primary active" role="button" aria-pressed="true"">Copy Query to Clipboard</button>
        <p>
        <div id="command_list"></div>
        <div id="advanced_query" style="font-family:courier; background-color:rgb(99, 45, 27);"></div>
        <p>
                                
        <div id="print_output"  style="background-color:rgb(6, 7, 0);"><pre></pre></div>></div>
        <!-- <py-script output="print_output" src="queryDict.py"></py-script> -->
        <py-script output="print_output" src="logseqquerybuilder.py"></py-script>
    </body>
    <script>
        document.getElementById("commands_input").focus()

        function copySummary(){
            let summaryText = document.getElementById("advanced_query").innerText

            navigator.clipboard.writeText(summaryText).then(function(){
                console.log("Copied to clipboard!")
            }, 
                function(err){
                    console.log("Could not copy text")
                }
            )
        }

        let copyButton = document.getElementById("copy");
        copyButton.addEventListener("click", copySummary);

    </script>
</html>
