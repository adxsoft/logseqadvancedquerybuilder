<!DOCTYPE html>
<html>
    <h3>Logseq Advanced Query Builder</h3>
    <small>v0.1</small>
    <!-- <div>
        <H3>TODO</H3>
        <ul>
        </ul>
    </div> -->
    <p>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Standard pyscript includes for pyscript components-->
        <!-- <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script> -->
        
        <!-- Standard includes for latest pyscript components-->
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css"/>
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>      
        
        <!-- Local includes for pyscript components -->
        <!-- <script defer src="/static/pyscript/pyscript.js"></script> -->
        
        <!-- Add bootstrap -->
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/css/bootstrap-night.min.css" rel="stylesheet"> -->

        <!-- Custom style.css -->
        <link rel="stylesheet" href="style.css" type="text/css">
        
        <title>Logseq Query Builder v0.01</title>
        <!-- <py-config>
            - autoclose_loader: true
            - runtimes:
                - src: "../static/pyodide/pyodide.js"
                  name: pyodide-0.20
                  lang: python
        </py-config> -->
        <!-- - pandas
        - xlrd -->
        <!-- - ./queryDict.py -->
        <!-- - ./logseq query building rules.xls -->
        <py-env> 
            - paths:
                - ./queryDB.py
                - ./logseqquerybuilder.py
        </py-env>
    </head>
    
    
    <body>
        <div style="width: 800px;">
            <div>
                <i>An Experimental online tool to help Logseq Users build advanced queries from simple commands.</i><br><hr>
            </div>   
            <details>
                <summary>FAQ</summary>
                    <details>
                        <summary>How to use</summary>
                        <div class="details-content">
                            The simple commands are entered as a text outline in the Command Input area<br>
                                <blockquote>
                                    <pre>
- commandname
    - argument
    - argument</pre>
                                  </blockquote>
                            <hr>
                            <ul>
                                <li>Enter commands in the yellow area below or choose an example.</li>
                                <li>Tick <i>Include Query Comments</i> to show query line comments</li>
                                <li>Tick  <i>Copy as code block</i> to wrap query in a Logseq code block</li>
                                <li>Click the <b>Generate Advanced Query</b> button</li>
                                to build the query.
                                <ol>
                                    <li>Optionally you can include comments for each query line.</i>
                                </ol>
                                <li>Copy the generated advanced query to the clipboard></li>
                                <ol>
                                    <li>(if necessary scroll down to see the result)</i>
                                </ol>
                                
                                <li>Paste into Logseq using <i>Cmd(or Ctrl) Shift V</i></li><hr>
                            </ul>
                        </div>
                    </details>
                    <details>
                        <summary>Simple Commands</summary>
                        <div>
                            <small>Note. Wildcards use *<br>
                            <blockquote>                            
                            test* - starts with text 'test'<br>
                            *end - ends with text 'end'<br>
                            *tax* - contains text 'tax'<br>
                        </small>
                            </blockquote>
                            <table>
                                <tr><td>Command</td><td>Description</td></tr>
                                <tr><td><b>blocks</b></td><td>select logseq blocks</td></tr>
                                <tr><td><b>blockproperties</b></td><td>select blocks by property values</td></tr>
                                <tr><td><b>blocktags</b></td><td>select blocks by tag</td></tr>
                                <tr><td><b>deadline</b></td><td>select pages or blocks that have a deadline</td></tr>
                                <tr><td><b>deadlinebetween</b></td><td>select pages or blocks that have a deadline in a date range</td></tr>
                                <tr><td><b>journalsbetween</b></td><td>only select journal pages in a date range</td></tr>
                                <tr><td><b>journalonly</b></td><td>only select journal pages</td></tr>
                                <tr><td><b>namespace</b></td><td>select pages or blocks within a namespace</td></tr>
                                <tr><td><b>pages</b></td><td>select logseq pages</td></tr>
                                <tr><td><b>pageproperties</b></td><td>select pages by page properties</td></tr>
                                <tr><td><b>pagetags</b></td><td>select pages by tag</td></tr>
                                <tr><td><b>tasks</b></td><td>select tasks</td></tr>
                                <tr><td><b>scheduled</b></td><td>select pages or blocks that are scheduled</td></tr>
                                <tr><td><b>scheduledbetween</b></td><td>select pages or blocks that are scheduled in a date range</td></tr>                            </table>
                        </div>
                    </details>
                </div>
            <hr>
        </div>
        <h5>Command Input</h5>
        <select id="command_examples">
            <option value='' selected>Choose Example..</option>
            <option value='title: pages command - pages by wildcards&#10- pages&#10    - *'>pages - select all pages</option>
            <option value='title: pages command - specific pages&#10- pages&#10    - yourpagetitle1&#10    - yourpagetitle2'>pages - select specific pages</option>
            <option value='title: pages command - pages by wildcards&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*'>pages - using wildcards (*)</option>
            <option value='title: pages command - ignore pages (including wildcards)&#10- pages&#10    - not yourpagetitle1&#10    - not yourpagetitle2    - not mypage*&#10    - not starttext*&#10    - not *endtext&#10    - not *anytextanywhere*'>pages - ignore various pages</option>
            <option value='title: blocks command - ignore blocks using wildcards&#10- pages&#10    - not starttext*&#10    - not *endtext&#10    - not *anytextanywhere*'>blocks - by wildcards</option>
            <option value='title: blocktags - select and exclude block level tags&#10- blocktags&#10    - tag1&#10    - tag2&#10    - not tag3'>blocktags - select and exclude block level tags</option>
            <option value='title: blocktags and pages example&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1- blocktags&#10    - tag1&#10    - tag2&#10    - not tag3'>blocktags and pages</option>
            <option value='title: pagetags - page level tags&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1&#10- pagetags&#10    - pagetag1&#10    - pagetag2&#10    - not pagetag3'>pagetags - page level tags</option>
            <option value='title: pagetags and pages&#10- pages&#10    - starttext*&#10    - *endtext&#10    - *anytextanywhere*&#10    - not pagetitle1&#10- pagetags&#10    - pagetag1&#10    - pagetag2&#10    - not pagetag3'>pagetags - with pages selection</option>
            <option value='title: select and exclude task types&#10- tasks&#10    - TODO&#10    - not DOING'>tasks - select and exclude task types</option>
            <option value='title: select and exclude task types&#10- pages&#10    - meeting*- tasks&#10    - TODO&#10    - not DOING'>tasks - tasks and pages</option>
            <option value='title: select and exclude pages with page properties&#10- pageproperties&#10    - pagetype, "meeting"&#10    - pagetype, "seminar"&#10    - not occurence, 1'>page properties - select pages using page property</option>
            <option value='title: select and exclude blocks with block properties&#10- blockproperties&#10    - grouptype, "meeting"&#10    - grouptype, "seminar"&#10    - not occurence, 1'>block properties - select blocks using block property</option>
            <option value='title: only search in specific namespace&#10- namespace&#10    - mynamespace'>namespace - only search in specific namespace</option>
            <option value='title: find block properties in a namespace&#10- namespace&#10    - fictionbooks&#10    - not nonfictionbooks&#10- blockproperties&#10    - bookgenre, "Western"&#10    - bookgenre, "History"'>namespace - find block properties in a namespace</option>
            <option value='title: find scheduled blocks in a namespace&#10- namespace&#10    - councilmeetings&#10    - not workmeetings&#10- scheduled'>scheduled - find scheduled blocks in a namespace</option>
            <option value='- schedulebetween&#10    - :today :30d-after'>scheduled - find scheduled blocks in a date range</option>
            <option value='title: find blocks with deadlines&#10- scheduled'>deadline - find blocks with deadlines</option>
            <option value='- deadlinebetween&#10    - :today :30d-after'>deadline - find deadline blocks in a date range</option>
        </select>
        <br>
        <p>
            <textarea id="commands_input" rows="10" cols="50">
            <pre></pre></textarea>
            <p>
            <button id="clear_commands_button" type="button">Clear</button>
        <hr>
        <h5>Generated Query</h5>
        <div class="checkbox">
            <input id='command_comments_checkbox' type="checkbox" style="margin-right:10px;" value="unchecked">Include Query Comments
            <input id='codeblock_checkbox' type="checkbox" style="margin-right:10px; margin-left:10px;" value="unchecked">Copy as code block<p>
        </div>
        <button id="generate_query_button" type="button">Generate Advanced Query</button>
        <button id="copy" hidden class="btn btn-primary active" role="button" aria-pressed="true">Copy Query to Clipboard</button>
        <p>
        <div id="command_list"></div>
        <br>
        <div id="advanced_query" style="background-color:rgb(197, 250, 188); border: 1; color:rgb(7, 7, 0);"></div>
        <p>
        <hr>                        
        <h5>Status</h5>
        <div id="print_output"  class="statusbar";>
            <pre>
                <py-script output="print_output" src="logseqquerybuilder.py"></py-script>
            </pre>
        </div>
    </div>
        
    </body>
    <script>
        document.getElementById("commands_input").focus()

        function copySummary(){
            let summaryText = document.getElementById("advanced_query").innerText

            navigator.clipboard.writeText(summaryText).then(function(){
                console.log("Copied to clipboard!")
            }, 
                function(err){
                    console.log("Could not copy text")
                }
            )
        }

        let copyButton = document.getElementById("copy");
        copyButton.addEventListener("click", copySummary);

    </script>
</html>
